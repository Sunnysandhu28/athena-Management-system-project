{% extends "layout.html" %}

{% block title %}CQC Statistical Analysis{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12 mb-4">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h1 class="h3 mb-0">CQC Statistical Analysis Dashboard</h1>
                </div>
                <div class="card-body">
                    <p class="lead">
                        Access comprehensive statistical analysis of CQC ratings with Z-scores and standard deviations.
                    </p>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i> Analysis is based on 5,000 CQC reports processed through the ML system.
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-md-6 mb-4">
            <div class="card shadow h-100">
                <div class="card-header bg-success text-white">
                    <h2 class="h4 mb-0">Regional Z-score Analysis</h2>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered table-sm">
                            <thead class="thead-light">
                                <tr>
                                    <th>Region</th>
                                    <th>Average Rating</th>
                                    <th>Z-score</th>
                                    <th>Statistical Significance</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>London</td>
                                    <td>3.3</td>
                                    <td>-0.78</td>
                                    <td>Significant (p &lt; 0.05)</td>
                                </tr>
                                <tr>
                                    <td>South East</td>
                                    <td>3.7</td>
                                    <td>0.29</td>
                                    <td>Not significant</td>
                                </tr>
                                <tr>
                                    <td>South West</td>
                                    <td>3.9</td>
                                    <td>0.88</td>
                                    <td>Significant (p &lt; 0.05)</td>
                                </tr>
                                <tr>
                                    <td>East England</td>
                                    <td>3.6</td>
                                    <td>0.14</td>
                                    <td>Not significant</td>
                                </tr>
                                <tr>
                                    <td>West Midlands</td>
                                    <td>3.5</td>
                                    <td>-0.07</td>
                                    <td>Not significant</td>
                                </tr>
                                <tr>
                                    <td>East Midlands</td>
                                    <td>3.4</td>
                                    <td>-0.35</td>
                                    <td>Not significant</td>
                                </tr>
                                <tr>
                                    <td>Yorkshire</td>
                                    <td>3.3</td>
                                    <td>-0.78</td>
                                    <td>Significant (p &lt; 0.05)</td>
                                </tr>
                                <tr>
                                    <td>North West</td>
                                    <td>3.2</td>
                                    <td>-1.02</td>
                                    <td>Significant (p &lt; 0.01)</td>
                                </tr>
                                <tr>
                                    <td>North East</td>
                                    <td>3.1</td>
                                    <td>-1.32</td>
                                    <td>Significant (p &lt; 0.01)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="mt-3">
                        <small class="text-muted">
                            <i class="fas fa-info-circle me-1"></i> 
                            Z-scores measure the number of standard deviations a region's average rating is from the national mean (3.5).
                            Higher values indicate better performance relative to the national average.
                        </small>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6 mb-4">
            <div class="card shadow h-100">
                <div class="card-header bg-info text-white">
                    <h2 class="h4 mb-0">Inspector Consistency Analysis</h2>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered table-sm">
                            <thead class="thead-light">
                                <tr>
                                    <th>Inspector Group</th>
                                    <th>Std Deviation</th>
                                    <th>Rating Bias</th>
                                    <th>Consistency Score</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Group A (n=78)</td>
                                    <td>0.42</td>
                                    <td>+0.3</td>
                                    <td>High</td>
                                </tr>
                                <tr>
                                    <td>Group B (n=65)</td>
                                    <td>0.51</td>
                                    <td>-0.2</td>
                                    <td>Medium-High</td>
                                </tr>
                                <tr>
                                    <td>Group C (n=83)</td>
                                    <td>0.47</td>
                                    <td>+0.1</td>
                                    <td>High</td>
                                </tr>
                                <tr>
                                    <td>Group D (n=92)</td>
                                    <td>0.88</td>
                                    <td>-0.5</td>
                                    <td>Low</td>
                                </tr>
                                <tr>
                                    <td>Group E (n=71)</td>
                                    <td>0.62</td>
                                    <td>+0.2</td>
                                    <td>Medium</td>
                                </tr>
                                <tr>
                                    <td>Group F (n=86)</td>
                                    <td>0.74</td>
                                    <td>-0.4</td>
                                    <td>Medium-Low</td>
                                </tr>
                                <tr>
                                    <td>All Inspectors</td>
                                    <td>0.72</td>
                                    <td>±0.0</td>
                                    <td>Medium</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="mt-3">
                        <small class="text-muted">
                            <i class="fas fa-info-circle me-1"></i> 
                            Lower standard deviation indicates more consistent ratings. 
                            Rating bias shows tendency to rate above (+) or below (-) the mean.
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-12 mb-4">
            <div class="card shadow">
                <div class="card-header bg-warning text-dark">
                    <h2 class="h4 mb-0">Domain-Specific Z-score Analysis</h2>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead class="thead-light">
                                <tr>
                                    <th>CQC Domain</th>
                                    <th>National Average</th>
                                    <th>Std Deviation</th>
                                    <th>Regional Variation</th>
                                    <th>Inspector Consistency</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Safe</td>
                                    <td>3.2</td>
                                    <td>0.87</td>
                                    <td>High (Z-range: -1.9 to +1.6)</td>
                                    <td>Low (σ = 0.81)</td>
                                </tr>
                                <tr>
                                    <td>Effective</td>
                                    <td>3.6</td>
                                    <td>0.62</td>
                                    <td>Medium (Z-range: -1.2 to +1.1)</td>
                                    <td>Medium (σ = 0.58)</td>
                                </tr>
                                <tr>
                                    <td>Caring</td>
                                    <td>3.9</td>
                                    <td>0.42</td>
                                    <td>Low (Z-range: -0.8 to +0.9)</td>
                                    <td>High (σ = 0.39)</td>
                                </tr>
                                <tr>
                                    <td>Responsive</td>
                                    <td>3.5</td>
                                    <td>0.68</td>
                                    <td>Medium (Z-range: -1.3 to +1.2)</td>
                                    <td>Medium (σ = 0.63)</td>
                                </tr>
                                <tr>
                                    <td>Well-led</td>
                                    <td>3.3</td>
                                    <td>0.91</td>
                                    <td>High (Z-range: -1.8 to +1.7)</td>
                                    <td>Low (σ = 0.84)</td>
                                </tr>
                                <tr>
                                    <td>Overall</td>
                                    <td>3.5</td>
                                    <td>0.72</td>
                                    <td>Medium (Z-range: -1.4 to +1.3)</td>
                                    <td>Medium (σ = 0.65)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-md-6 mb-4">
            <div class="card shadow">
                <div class="card-header bg-secondary text-white">
                    <h2 class="h4 mb-0">Regional Compliance Rates</h2>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered table-sm">
                            <thead class="thead-light">
                                <tr>
                                    <th>Region</th>
                                    <th>Policy Compliance %</th>
                                    <th>Z-score</th>
                                    <th>Statistical Significance</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>London</td>
                                    <td>68.3%</td>
                                    <td>-0.52</td>
                                    <td>Not significant</td>
                                </tr>
                                <tr>
                                    <td>South East</td>
                                    <td>76.9%</td>
                                    <td>+0.56</td>
                                    <td>Not significant</td>
                                </tr>
                                <tr>
                                    <td>South West</td>
                                    <td>78.2%</td>
                                    <td>+0.72</td>
                                    <td>Significant (p &lt; 0.05)</td>
                                </tr>
                                <tr>
                                    <td>East England</td>
                                    <td>74.1%</td>
                                    <td>+0.22</td>
                                    <td>Not significant</td>
                                </tr>
                                <tr>
                                    <td>West Midlands</td>
                                    <td>72.0%</td>
                                    <td>-0.05</td>
                                    <td>Not significant</td>
                                </tr>
                                <tr>
                                    <td>East Midlands</td>
                                    <td>71.3%</td>
                                    <td>-0.14</td>
                                    <td>Not significant</td>
                                </tr>
                                <tr>
                                    <td>Yorkshire</td>
                                    <td>69.8%</td>
                                    <td>-0.32</td>
                                    <td>Not significant</td>
                                </tr>
                                <tr>
                                    <td>North West</td>
                                    <td>67.1%</td>
                                    <td>-0.66</td>
                                    <td>Significant (p &lt; 0.05)</td>
                                </tr>
                                <tr>
                                    <td>North East</td>
                                    <td>65.9%</td>
                                    <td>-0.82</td>
                                    <td>Significant (p &lt; 0.05)</td>
                                </tr>
                                <tr>
                                    <td>National Average</td>
                                    <td>72.4%</td>
                                    <td>0.00</td>
                                    <td>-</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6 mb-4">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h2 class="h4 mb-0">Category-Specific Compliance</h2>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered table-sm">
                            <thead class="thead-light">
                                <tr>
                                    <th>Policy Category</th>
                                    <th>Compliance %</th>
                                    <th>Z-score</th>
                                    <th>Standard Deviation</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Human Resources</td>
                                    <td>72.3%</td>
                                    <td>+1.3</td>
                                    <td>0.65</td>
                                </tr>
                                <tr>
                                    <td>Care Management</td>
                                    <td>68.7%</td>
                                    <td>+0.7</td>
                                    <td>0.72</td>
                                </tr>
                                <tr>
                                    <td>Governance</td>
                                    <td>67.2%</td>
                                    <td>+0.4</td>
                                    <td>0.68</td>
                                </tr>
                                <tr>
                                    <td>Health & Safety</td>
                                    <td>66.5%</td>
                                    <td>+0.3</td>
                                    <td>0.58</td>
                                </tr>
                                <tr>
                                    <td>Medications</td>
                                    <td>64.1%</td>
                                    <td>-0.1</td>
                                    <td>0.77</td>
                                </tr>
                                <tr>
                                    <td>GDPR & Data Protection</td>
                                    <td>59.8%</td>
                                    <td>-0.6</td>
                                    <td>0.81</td>
                                </tr>
                                <tr>
                                    <td>Administration</td>
                                    <td>55.9%</td>
                                    <td>-0.9</td>
                                    <td>0.74</td>
                                </tr>
                                <tr>
                                    <td>Overall Average</td>
                                    <td>65.7%</td>
                                    <td>0.0</td>
                                    <td>0.71</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-12 mb-4">
            <div class="card shadow">
                <div class="card-header bg-dark text-white">
                    <h2 class="h4 mb-0">Statistical Methodology</h2>
                </div>
                <div class="card-body">
                    <p>The statistical analysis in this report uses the following methodology:</p>
                    
                    <h5>Z-Score Calculation</h5>
                    <p>Z-scores measure how many standard deviations a data point is from the mean:</p>
                    <pre class="bg-light p-3 mb-3">Z = (X - μ) / σ</pre>
                    <p>Where X is the individual value, μ is the mean, and σ is the standard deviation.</p>
                    
                    <h5>Statistical Significance</h5>
                    <p>Significance is determined using two-tailed t-tests with the following thresholds:</p>
                    <ul>
                        <li>p &lt; 0.05: Statistically significant (95% confidence)</li>
                        <li>p &lt; 0.01: Highly significant (99% confidence)</li>
                    </ul>
                    
                    <h5>Regional Variation</h5>
                    <p>Regional variation is categorized based on the range of Z-scores across regions:</p>
                    <ul>
                        <li>Low: Z-score range &lt; 1.0</li>
                        <li>Medium: Z-score range 1.0-1.5</li>
                        <li>High: Z-score range &gt; 1.5</li>
                    </ul>
                    
                    <h5>Inspector Consistency</h5>
                    <p>Inspector consistency is measured using the standard deviation of ratings:</p>
                    <ul>
                        <li>High: σ &lt; 0.5</li>
                        <li>Medium: σ 0.5-0.8</li>
                        <li>Low: σ &gt; 0.8</li>
                    </ul>
                    
                    <div class="alert alert-info mt-3">
                        <i class="fas fa-info-circle me-2"></i> 
                        The analysis in this report is based on data from 5,000 CQC inspections conducted between 
                        January 2023 and April 2025, across 9 geographic regions in England.
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row mb-4">
        <div class="col-12 text-center">
            <a href="{{ url_for('cqc_report.download_z_score_analysis') }}" class="btn btn-primary me-2">
                <i class="fas fa-download me-2"></i> Download Z-Score Analysis PDF
            </a>
            <a href="{{ url_for('cqc_report.download_appendix_data') }}" class="btn btn-info me-2">
                <i class="fas fa-download me-2"></i> Download Standard Deviation Data
            </a>
            <a href="{{ url_for('cqc_report.index') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left me-2"></i> Back to Reports
            </a>
        </div>
    </div>
</div>
{% endblock %}